<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gitesh Goal Recommendation System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>‚úì</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: 600;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 13px;
            margin-bottom: 30px;
        }

        .lists-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .list-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        h2 {
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }

        .recommend-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .recommend-btn:hover {
            background: #0056b3;
        }

        .recommendation {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #333;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .recommendation.empty {
            color: #999;
        }

        .change-btn {
            background: transparent;
            border: 1px solid #007bff;
            color: #007bff;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-left: 10px;
        }

        .change-btn:hover {
            background: #007bff;
            color: white;
        }

        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
        }

        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .add-btn:hover {
            background: #218838;
        }

        .checklist {
            list-style: none;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .checklist-item:hover {
            background: #e9ecef;
        }

        .checklist-item.completed {
            opacity: 0.6;
        }

        .checklist-item.completed .item-text {
            text-decoration: line-through;
        }

        input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .item-text {
            flex: 1;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            user-select: none;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        .item-text:hover {
            color: #007bff;
        }

        .move-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-right: 8px;
            transition: background 0.2s;
        }

        .move-btn:hover {
            background: #5a6268;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .checklist-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 20px;
            font-size: 14px;
        }

        .list-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .task-counter {
            font-size: 13px;
            color: #666;
        }

        .clear-completed-btn {
            background: transparent;
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .clear-completed-btn:hover {
            background: #dc3545;
            color: white;
        }

        .clear-completed-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
                overflow-x: hidden;
            }

            .container {
                max-width: 100%;
                overflow-x: hidden;
            }

            h1 {
                font-size: 16px;
                margin-bottom: 5px;
            }

            .subtitle {
                font-size: 10px;
                margin-bottom: 10px;
            }

            #search-input {
                font-size: 11px !important;
                padding: 6px !important;
                max-width: 100% !important;
            }

            #search-input + div button {
                font-size: 10px !important;
                padding: 5px 8px !important;
                margin: 2px !important;
            }

            .lists-container {
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }
        }

        /* Very small screens - stack vertically */
        @media (max-width: 480px) {
            .lists-container {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            h1 {
                font-size: 18px;
            }

            .subtitle {
                font-size: 11px;
            }
        }

            .list-section {
                padding: 8px;
                min-width: 0;
            }

            h2 {
                font-size: 13px;
            }

            .list-header {
                margin-bottom: 10px;
            }

            .recommend-btn {
                font-size: 9px;
                padding: 3px 6px;
            }

            .recommendation {
                font-size: 11px;
                padding: 6px;
                min-height: 30px;
                margin-bottom: 10px;
            }

            .input-group {
                margin-bottom: 10px;
                gap: 4px;
            }

            input[type="text"] {
                font-size: 11px;
                padding: 6px;
                min-width: 0;
            }

            .add-btn {
                font-size: 11px;
                padding: 6px 10px;
                white-space: nowrap;
            }

            .checklist-item {
                padding: 6px;
                margin-bottom: 6px;
            }

            .item-text {
                font-size: 11px;
                word-break: break-word;
            }

            .move-btn {
                font-size: 12px;
                padding: 2px 4px;
                margin-right: 4px;
            }

            .delete-btn {
                font-size: 9px;
                padding: 2px 4px;
            }

            .change-btn {
                font-size: 9px;
                padding: 2px 4px;
            }

            .clear-completed-btn {
                font-size: 9px;
                padding: 3px 5px;
            }

            input[type="checkbox"] {
                width: 14px;
                height: 14px;
                margin-right: 6px;
            }

            .task-counter {
                font-size: 10px;
            }

            .list-footer {
                margin-top: 8px;
                padding-top: 8px;
                flex-wrap: wrap;
                gap: 5px;
            }

            .list-footer > div {
                display: flex;
                gap: 3px;
                flex-wrap: wrap;
            }

            .empty-state {
                font-size: 11px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gitesh Goal Recommendation System</h1>
        <p class="subtitle">Double-click goals to edit ‚Ä¢ Use ‚Üí button to move between lists ‚Ä¢ <span id="sync-status" style="color: #28a745;">‚òÅÔ∏è Cloud Synced</span></p>

        <div style="text-align: center; margin-bottom: 20px;">
            <input type="text" id="search-input" placeholder="üîç Search goals..." style="width: 100%; max-width: 400px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; margin-bottom: 10px;" oninput="handleSearch()">
            <div style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; align-items: center;">
                <button onclick="undo()" style="background: #ffc107; color: #333; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Undo last action (Ctrl+Z)">‚Ü∂ Undo</button>
                <button onclick="manualSync()" style="background: #17a2b8; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Refresh from cloud">üîÑ Sync</button>
                <button onclick="showStats()" style="background: #6f42c1; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">üìä Stats</button>
                <button onclick="exportData()" style="background: #28a745; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Download backup JSON">üíæ Export</button>
                <button onclick="document.getElementById('import-file').click()" style="background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" title="Upload backup JSON">üìÅ Import</button>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importData(event)">
            </div>
        </div>

        <div class="lists-container">
            <!-- Personal List -->
            <div class="list-section" data-list-type="personal">
                <div class="list-header">
                    <h2>Personal <span id="personal-badge" style="background: #e7f3ff; color: #007bff; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: normal;">0</span></h2>
                    <div>
                        <button class="recommend-btn" onclick="toggleSort('personal')" title="Sort alphabetically" style="margin-right: 5px;">A-Z</button>
                        <button class="recommend-btn" onclick="recommendGoal('personal')">Recommend</button>
                    </div>
                </div>

                <div class="recommendation empty" id="personal-recommendation">
                    <span>Add goals, then click recommend</span>
                </div>

                <div class="input-group">
                    <input type="text" id="personal-input" placeholder="Add goal(s) - paste multiple lines for bulk add..." onkeypress="handleKeyPress(event, 'personal')" onpaste="handlePaste(event, 'personal')">
                    <button class="add-btn" onclick="addItem('personal')">Add</button>
                </div>

                <ul class="checklist" id="personal-list">
                    <li class="empty-state">No goals yet. Add one above!</li>
                </ul>

                <div class="list-footer">
                    <span class="task-counter" id="personal-counter">0 of 0 completed</span>
                    <div>
                        <button class="clear-completed-btn" onclick="clearCompleted('personal')" id="personal-clear">Clear Completed</button>
                        <button class="clear-completed-btn" onclick="clearAll('personal')" style="margin-left: 5px;">Clear All</button>
                    </div>
                </div>
            </div>

            <!-- Professional List -->
            <div class="list-section" data-list-type="professional">
                <div class="list-header">
                    <h2>Professional <span id="professional-badge" style="background: #e7f3ff; color: #007bff; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: normal;">0</span></h2>
                    <div>
                        <button class="recommend-btn" onclick="toggleSort('professional')" title="Sort alphabetically" style="margin-right: 5px;">A-Z</button>
                        <button class="recommend-btn" onclick="recommendGoal('professional')">Recommend</button>
                    </div>
                </div>

                <div class="recommendation empty" id="professional-recommendation">
                    <span>Add goals, then click recommend</span>
                </div>

                <div class="input-group">
                    <input type="text" id="professional-input" placeholder="Add goal(s) - paste multiple lines for bulk add..." onkeypress="handleKeyPress(event, 'professional')" onpaste="handlePaste(event, 'professional')">
                    <button class="add-btn" onclick="addItem('professional')">Add</button>
                </div>

                <ul class="checklist" id="professional-list">
                    <li class="empty-state">No goals yet. Add one above!</li>
                </ul>

                <div class="list-footer">
                    <span class="task-counter" id="professional-counter">0 of 0 completed</span>
                    <div>
                        <button class="clear-completed-btn" onclick="clearCompleted('professional')" id="professional-clear">Clear Completed</button>
                        <button class="clear-completed-btn" onclick="clearAll('professional')" style="margin-left: 5px;">Clear All</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="stats-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
            <h2 style="margin-top: 0;">üìä Your Stats</h2>
            <div id="stats-content"></div>
            <button onclick="closeStats()" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 20px; width: 100%;">Close</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCZcEWiJSDKkwVCgDeFfdoI1z3_Bc3FxEE",
            authDomain: "gitesh-checklist.firebaseapp.com",
            projectId: "gitesh-checklist",
            storageBucket: "gitesh-checklist.firebasestorage.app",
            messagingSenderId: "867346897634",
            appId: "1:867346897634:web:6c6bdaa2e42cc2190b5cbb",
            measurementId: "G-3TFN5FZZMH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.db = db;
        window.firestoreDoc = doc;
        window.firestoreSetDoc = setDoc;
        window.firestoreGetDoc = getDoc;
        window.firestoreOnSnapshot = onSnapshot;
        window.firebaseReady = true;

        // Trigger load once Firebase is ready
        if (window.onFirebaseReady) window.onFirebaseReady();
    </script>

    <script>
        // Cloud sync with Firestore - unique user ID per device
        function getUserId() {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            return userId;
        }

        const CLOUD_DOC_ID = getUserId();
        let isLoadingFromCloud = false;
        let isOnline = navigator.onLine;

        // Load data from localStorage first (fallback)
        let personalGoals = JSON.parse(localStorage.getItem('personalGoals')) || [];
        let professionalGoals = JSON.parse(localStorage.getItem('professionalGoals')) || [];
        let idCounter = Date.now();

        // Generate unique ID
        function generateId() {
            return idCounter++;
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Search/filter state
        let searchTerm = '';

        // Sort state
        let sortAlphabetically = { personal: false, professional: false };

        // Undo state
        let undoStack = [];

        function saveUndoState() {
            undoStack.push({
                personal: JSON.parse(JSON.stringify(personalGoals)),
                professional: JSON.parse(JSON.stringify(professionalGoals))
            });
            if (undoStack.length > 10) undoStack.shift(); // Keep only last 10 states
        }

        function undo() {
            if (undoStack.length === 0) {
                alert('Nothing to undo');
                return;
            }
            const prevState = undoStack.pop();
            personalGoals = prevState.personal;
            professionalGoals = prevState.professional;
            saveData('personal');
            saveData('professional');
            renderList('personal');
            renderList('professional');
        }

        function toggleSort(type) {
            sortAlphabetically[type] = !sortAlphabetically[type];
            renderList(type);
        }

        // Cloud sync functions
        async function loadFromCloud() {
            if (!window.firebaseReady || !window.db) {
                console.log('Firebase not ready yet');
                return;
            }

            try {
                const docRef = window.firestoreDoc(window.db, 'goals', CLOUD_DOC_ID);
                const docSnap = await window.firestoreGetDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    isLoadingFromCloud = true;
                    personalGoals = data.personal || [];
                    professionalGoals = data.professional || [];

                    // Also save to localStorage as backup
                    localStorage.setItem('personalGoals', JSON.stringify(personalGoals));
                    localStorage.setItem('professionalGoals', JSON.stringify(professionalGoals));

                    renderList('personal');
                    renderList('professional');
                    isLoadingFromCloud = false;
                    console.log('‚úÖ Loaded from cloud');
                } else {
                    // No cloud data, upload current local data
                    await saveToCloud();
                }

                // Listen for real-time updates
                window.firestoreOnSnapshot(docRef, (doc) => {
                    if (doc.exists() && !isLoadingFromCloud) {
                        const data = doc.data();
                        personalGoals = data.personal || [];
                        professionalGoals = data.professional || [];
                        renderList('personal');
                        renderList('professional');
                        console.log('üîÑ Synced from cloud');
                    }
                });
            } catch (error) {
                console.error('Error loading from cloud:', error);
            }
        }

        async function saveToCloud() {
            if (!window.firebaseReady || !window.db) return;

            try {
                const statusEl = document.getElementById('sync-status');
                if (statusEl) statusEl.innerHTML = '<span style="color: #ffc107;">‚è≥ Syncing...</span>';

                const docRef = window.firestoreDoc(window.db, 'goals', CLOUD_DOC_ID);
                await window.firestoreSetDoc(docRef, {
                    personal: personalGoals,
                    professional: professionalGoals,
                    lastUpdated: new Date().toISOString()
                });

                if (statusEl) statusEl.innerHTML = '<span style="color: #28a745;">‚òÅÔ∏è Cloud Synced</span>';
                console.log('‚òÅÔ∏è Saved to cloud');
            } catch (error) {
                console.error('Error saving to cloud:', error);
                const statusEl = document.getElementById('sync-status');
                if (statusEl) statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå Sync Error</span>';
            }
        }

        // Manual sync function
        async function manualSync() {
            if (!navigator.onLine) {
                alert('You are offline. Please check your internet connection.');
                return;
            }
            if (!window.firebaseReady) {
                alert('Firebase not initialized. Please refresh the page.');
                return;
            }

            const statusEl = document.getElementById('sync-status');
            if (statusEl) statusEl.innerHTML = '<span style="color: #ffc107;">üîÑ Syncing...</span>';

            try {
                await loadFromCloud();
                if (statusEl) statusEl.innerHTML = '<span style="color: #28a745;">‚úÖ Synced!</span>';
                setTimeout(() => {
                    if (statusEl) statusEl.innerHTML = '<span style="color: #28a745;">‚òÅÔ∏è Cloud Synced</span>';
                }, 2000);
            } catch (error) {
                if (statusEl) statusEl.innerHTML = '<span style="color: #dc3545;">‚ùå Sync Failed</span>';
                alert('Sync failed. Please try again.');
            }
        }

        // Online/Offline detection
        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            const statusEl = document.getElementById('sync-status');
            if (!statusEl) return;

            if (!isOnline) {
                statusEl.innerHTML = '<span style="color: #ffc107;">üì¥ Offline Mode</span>';
            } else if (window.firebaseReady) {
                statusEl.innerHTML = '<span style="color: #28a745;">‚òÅÔ∏è Cloud Synced</span>';
            }
        }

        // Initialize on page load
        window.onFirebaseReady = function() {
            loadFromCloud();
        };

        window.onload = function() {
            renderList('personal');
            renderList('professional');

            // If Firebase is already ready, load from cloud
            if (window.firebaseReady) {
                loadFromCloud();
            }

            // Online/Offline listeners
            window.addEventListener('online', () => {
                updateOnlineStatus();
                if (window.firebaseReady) {
                    loadFromCloud(); // Sync when coming back online
                }
            });
            window.addEventListener('offline', updateOnlineStatus);

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'z') {
                    e.preventDefault();
                    undo();
                }
            });
        };

        function handleSearch() {
            searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            renderList('personal');
            renderList('professional');
        }

        function exportData() {
            const data = {
                personal: personalGoals,
                professional: professionalGoals,
                exportDate: new Date().toISOString()
            };
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `goals-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm('This will replace your current goals and sync to cloud. Continue?')) {
                        saveUndoState(); // Allow undo
                        personalGoals = data.personal || [];
                        professionalGoals = data.professional || [];
                        saveData('personal');
                        saveData('professional');
                        renderList('personal');
                        renderList('professional');
                        // Cloud sync happens automatically via saveData
                        alert('Goals imported and synced to cloud successfully!');
                    }
                } catch (error) {
                    alert('Error importing file. Please check the file format.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function recommendGoal(type) {
            const goals = type === 'personal' ? personalGoals : professionalGoals;
            const uncompletedGoals = goals.filter(g => !g.completed);

            const recElement = document.getElementById(`${type}-recommendation`);

            if (uncompletedGoals.length === 0) {
                recElement.innerHTML = '<span class="empty">Add some goals first to get recommendations!</span>';
                recElement.classList.add('empty');
                return;
            }

            const randomIndex = Math.floor(Math.random() * uncompletedGoals.length);
            const recommendedGoal = uncompletedGoals[randomIndex];

            recElement.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                    <input type="checkbox" onchange="completeRecommendation('${type}', ${recommendedGoal.id})" style="width: 18px; height: 18px; cursor: pointer;">
                    <span>${escapeHtml(recommendedGoal.text)}</span>
                </div>
                <button class="change-btn" onclick="recommendGoal('${type}')">Change</button>
            `;
            recElement.classList.remove('empty');
        }

        function completeRecommendation(type, goalId) {
            const goals = type === 'personal' ? personalGoals : professionalGoals;
            const goal = goals.find(g => g.id === goalId);

            if (goal) {
                goal.completed = true;
                saveData(type);
                renderList(type);
                // Get a new recommendation
                recommendGoal(type);
            }
        }

        function addItem(type) {
            const input = document.getElementById(`${type}-input`);
            const text = input.value.trim().toLowerCase();

            if (text === '') return;

            const goals = type === 'personal' ? personalGoals : professionalGoals;
            goals.push({
                id: generateId(),
                text: text,
                completed: false
            });

            saveData(type);
            renderList(type);
            input.value = '';
        }

        function toggleItem(type, id) {
            const goals = type === 'personal' ? personalGoals : professionalGoals;
            const goal = goals.find(g => g.id === id);
            if (goal) {
                goal.completed = !goal.completed;
                saveData(type);
                renderList(type);
            }
        }

        function deleteItem(type, id) {
            saveUndoState();
            if (type === 'personal') {
                personalGoals = personalGoals.filter(g => g.id !== id);
            } else {
                professionalGoals = professionalGoals.filter(g => g.id !== id);
            }
            saveData(type);
            renderList(type);
        }

        function moveItem(sourceType, id) {
            saveUndoState();
            const targetType = sourceType === 'personal' ? 'professional' : 'personal';
            const sourceGoals = sourceType === 'personal' ? personalGoals : professionalGoals;
            const targetGoals = targetType === 'personal' ? personalGoals : professionalGoals;

            const goalIndex = sourceGoals.findIndex(g => g.id === id);
            if (goalIndex === -1) return;

            const goal = sourceGoals[goalIndex];
            sourceGoals.splice(goalIndex, 1);
            targetGoals.push(goal);

            saveData(sourceType);
            saveData(targetType);
            renderList(sourceType);
            renderList(targetType);
        }

        function editItem(type, id, element) {
            const goals = type === 'personal' ? personalGoals : professionalGoals;
            const goal = goals.find(g => g.id === id);
            if (!goal) return;

            const currentText = goal.text;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.className = 'item-text';
            input.style.flex = '1';
            input.style.border = '1px solid #007bff';
            input.style.padding = '4px';
            input.style.borderRadius = '3px';

            const saveEdit = () => {
                const newText = input.value.trim().toLowerCase();
                if (newText && newText !== currentText) {
                    goal.text = newText;
                    saveData(type);
                }
                renderList(type);
            };

            input.onblur = saveEdit;
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                } else if (e.key === 'Escape') {
                    renderList(type);
                }
            };

            element.replaceWith(input);
            input.focus();
            input.select();
        }

        function renderList(type) {
            const listElement = document.getElementById(`${type}-list`);
            const goals = type === 'personal' ? personalGoals : professionalGoals;

            // Update counter
            const completed = goals.filter(g => g.completed).length;
            const total = goals.length;
            const counterElement = document.getElementById(`${type}-counter`);

            // Update badge count
            const badgeElement = document.getElementById(`${type}-badge`);
            if (badgeElement) {
                badgeElement.textContent = total;
            }

            if (total === 0) {
                counterElement.textContent = 'No goals yet';
            } else if (completed === total) {
                counterElement.textContent = `All done! (${total} completed)`;
            } else {
                counterElement.textContent = `${completed} of ${total} completed`;
            }

            // Update clear button state
            const clearBtn = document.getElementById(`${type}-clear`);
            clearBtn.disabled = completed === 0;

            if (goals.length === 0) {
                listElement.innerHTML = '<li class="empty-state">No goals yet. Add one above!</li>';
                return;
            }

            // Filter by search term
            let filteredGoals = goals;
            if (searchTerm) {
                filteredGoals = goals.filter(g => g.text.toLowerCase().includes(searchTerm));
            }

            // Sort: uncompleted first, completed at bottom, then alphabetically if enabled
            const sortedGoals = [...filteredGoals].sort((a, b) => {
                if (a.completed !== b.completed) {
                    return a.completed - b.completed;
                }
                if (sortAlphabetically[type]) {
                    return a.text.localeCompare(b.text);
                }
                return 0;
            });

            if (sortedGoals.length === 0 && searchTerm) {
                listElement.innerHTML = '<li class="empty-state">No goals match your search</li>';
                return;
            }

            listElement.innerHTML = sortedGoals.map(goal => `
                <li class="checklist-item ${goal.completed ? 'completed' : ''}" data-id="${goal.id}" data-type="${type}">
                    <button class="move-btn" onclick="moveItem('${type}', ${goal.id})" title="Move to ${type === 'personal' ? 'Professional' : 'Personal'}">‚Üí</button>
                    <input type="checkbox" ${goal.completed ? 'checked' : ''}
                           onchange="toggleItem('${type}', ${goal.id})">
                    <span class="item-text" ondblclick="editItem('${type}', ${goal.id}, this)" title="Double-click to edit">${escapeHtml(goal.text)}</span>
                    <button class="delete-btn" onclick="deleteItem('${type}', ${goal.id})">Delete</button>
                </li>
            `).join('');
        }

        function saveData(type) {
            if (type === 'personal') {
                localStorage.setItem('personalGoals', JSON.stringify(personalGoals));
            } else {
                localStorage.setItem('professionalGoals', JSON.stringify(professionalGoals));
            }
            // Also save to cloud
            saveToCloud();
        }

        function clearCompleted(type) {
            saveUndoState();
            if (type === 'personal') {
                personalGoals = personalGoals.filter(g => !g.completed);
            } else {
                professionalGoals = professionalGoals.filter(g => !g.completed);
            }
            saveData(type);
            renderList(type);
        }

        function clearAll(type) {
            if (!confirm('Are you sure you want to delete all goals?')) return;

            saveUndoState();
            if (type === 'personal') {
                personalGoals = [];
            } else {
                professionalGoals = [];
            }
            saveData(type);
            renderList(type);
        }

        function handleKeyPress(event, type) {
            if (event.key === 'Enter') {
                addItem(type);
            }
        }

        function handlePaste(event, type) {
            // Prevent default paste behavior
            event.preventDefault();

            // Get pasted text
            const pastedText = (event.clipboardData || window.clipboardData).getData('text');

            // Split by new lines and filter out empty lines
            const lines = pastedText.split(/\r?\n/).filter(line => line.trim() !== '');

            if (lines.length === 0) return;

            // If only one line, just set it in the input field
            if (lines.length === 1) {
                const input = document.getElementById(`${type}-input`);
                input.value = lines[0].trim().toLowerCase();
                return;
            }

            // Multiple lines - add them all as separate goals
            const goals = type === 'personal' ? personalGoals : professionalGoals;

            lines.forEach(line => {
                const text = line.trim().toLowerCase();
                if (text) {
                    goals.push({
                        id: generateId(),
                        text: text,
                        completed: false
                    });
                }
            });

            saveData(type);
            renderList(type);

            // Clear the input field
            const input = document.getElementById(`${type}-input`);
            input.value = '';
        }

        // Stats functions
        function showStats() {
            const totalPersonal = personalGoals.length;
            const completedPersonal = personalGoals.filter(g => g.completed).length;
            const totalProfessional = professionalGoals.length;
            const completedProfessional = professionalGoals.filter(g => g.completed).length;
            const total = totalPersonal + totalProfessional;
            const completed = completedPersonal + completedProfessional;
            const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

            const statsHtml = `
                <div style="line-height: 2;">
                    <p><strong>Total Goals:</strong> ${total}</p>
                    <p><strong>Completed:</strong> ${completed}</p>
                    <p><strong>Remaining:</strong> ${total - completed}</p>
                    <p><strong>Completion Rate:</strong> ${completionRate}%</p>
                    <hr style="margin: 15px 0;">
                    <p><strong>Personal:</strong> ${completedPersonal}/${totalPersonal}</p>
                    <p><strong>Professional:</strong> ${completedProfessional}/${totalProfessional}</p>
                </div>
            `;

            document.getElementById('stats-content').innerHTML = statsHtml;
            document.getElementById('stats-modal').style.display = 'flex';
        }

        function closeStats() {
            document.getElementById('stats-modal').style.display = 'none';
        }

        // Close modal on outside click
        document.getElementById('stats-modal')?.addEventListener('click', function(e) {
            if (e.target === this) closeStats();
        });
    </script>
</body>
</html>